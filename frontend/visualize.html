<!DOCTYPE html>
<meta charset="utf-8">

<style>
.svg-container {
    display: inline-block;
    position: relative;
    width: 100%;
    padding-bottom: 100%; /* aspect ratio */
    vertical-align: top;
    overflow: hidden;
}
.svg-content-responsive {
    display: inline-block;
    position: absolute;
    top: 10px;
    left: 0;
}

.axis {
    stroke-opacity: 0.1;
}

.view {
    width: 100%;
    height: 100%;
    fill: white;
}

</style>

<body style="overflow: hidden;">
<script src="http://d3js.org/d3.v4.min.js"></script>

<script>
// The script is based on 
// http://bl.ocks.org/mbostock/3680957,
// http://bl.ocks.org/mbostock/3887118,
// though translated from v3 to v4.

// Responsive SVG is per http://stackoverflow.com/a/25978286/5338270

var svg = d3.select('body')
    .append('div').classed('svg-container', true)
      .append('svg')
      .attr("preserveAspectRatio", "xMinYMin meet")
      .attr("viewBox", "0 0 600 400")
      .classed("svg-content-responsive", true);

var width = 600;
var height = 400;

var x = d3.scaleLinear().range([0, width]);

var y = d3.scaleLinear().range([height, 0]);

var data = d3.tsv("http://localhost:8000/tsne_output.tsv", function (error, data) {
    if(error){
        return console.log(error);
    }

    data.forEach(function (d) {
        // Convert to integers.
        d.x = +d.x;
        d.y = +d.y;
    });

    // Initially, scaleLinear transforms from [0..1] to a specified range.
    // Modify scales to be able to transform from [min_x..max_x] (same for `y`).
    x.domain(d3.extent(data, function(d) { return d.x; })).nice();
    y.domain(d3.extent(data, function(d) { return d.y; })).nice();

    main(data);
}).get();

function main(data) {
    var zoom = d3.zoom()
        .scaleExtent([0.1, 40])
        .on("zoom", zoomed);

    var xAxis = d3.axisBottom(x)
        .ticks((width + 2) / (height + 2) * 10)
        .tickSize(height)
        .tickPadding(8 - height);

    var yAxis = d3.axisRight(y)
        .ticks(10)
        .tickSize(width)
        .tickPadding(8 - width);

    var view = svg.append("rect")
        .attr("class", "view")
        .attr("x", 0.5)
        .attr("y", 0.5)
        .attr("width", width - 1)
        .attr("height", height - 1);

    var gX = svg.append("g")
        .attr("class", "axis axis--x")
        .call(xAxis);

    var gY = svg.append("g")
        .attr("class", "axis axis--y")
        .call(yAxis);

    svg.call(zoom);

    var g = svg.append('g');
    
    // About adding text to circles: http://stackoverflow.com/a/13627065/5338270
    var elements = g.selectAll('g').data(data);

    // About entering elements: https://bost.ocks.org/mike/circles/
    var elemEnter = elements.enter().append("g")
        .attr('transform', transform);

    var circle = elemEnter.append('circle')
          .attr('r', 2.5)
          .attr('fill', 'blue')
    elemEnter.append('text')
        .text(function(d) { return d.name; });



    function zoomed() {
      view.attr("transform", d3.event.transform);
      g.attr("transform", d3.event.transform);
      gX.call(xAxis.scale(d3.event.transform.rescaleX(x)));
      gY.call(yAxis.scale(d3.event.transform.rescaleY(y)));
    }
    
    function transform(d) {
        /*
        console.log(d.x);
        console.log(d.y);
        console.log("translate(" + x(d.x) + "," + y(d.y) + ")");
        */
        return "translate(" + x(d.x) + "," + y(d.y) + ")";
    }

}


</script>

</body>
